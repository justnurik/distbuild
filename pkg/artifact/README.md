# artifact

Пакет `artifact` реализует кеш хранения артефактов и протокол для передачи артефактов между воркерами.

Артефакт - это директория, содержащая в себе результат работы джоба. Артефакт может состоять из произвольного
набора файлов и директорий.

Основной тип `artifact.Cache` занимается хранением артефактов на диске и контролем одновременного доступа.
Все методы `artifact.Cache` *concurrency safe*.

Одна горутина может начать писать артефакт. Начало записи берёт лок на запись. Никто другой не может работать с артефактом,
на который взят лок на запись. Горутина должна позвать `commit` или `abort` после того, как она закончила работать с артефактом.

`commit` помещает артефакт в кеш. `abort` отменяет запись артефакта, удаляя все данные.

## Скачивание артефакта

`*artifact.Handler`  один метод `GET /artifact?id=1234`. Хендлер отвечает на
запрос содержимым артефакта в формате `tarstream`.

Функция `Download` скачивает артефакт из удалённого кеша в локальный.

## Использование

Инициализация
```go
cache, err := artifact.NewCache("/storage/path")
if err != nil { ... }
handler := artifact.NewHandler(logger, cache)
```

Пример создания
```go
path, commit, abort, err := cache.Create(id)
if err != nil { ... }

// что-то делаем с path

// Фиксация
if err := cache.Commit(ctx, id); err != nil { ... }
```

Пример скачивания
```go
err := artifact.Download(
    ctx,
    "http://remote-worker:8080",
    localCache,
    artifactID,
)
```
